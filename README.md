# Лабораторная работа №2  
## по дисциплине «Компьютерное зрение»

### Реализация прототипа трекинга объекта на видео  
**на основе ключевых точек и оптического потока**

---

## Цель работы

Разработать прототип системы трекинга объекта на видео, использующей ключевые точки и метод оптического потока, а также исследовать устойчивость алгоритма при различных условиях съёмки.

---

## Теоретическая база

### Трекинг объекта на видео

Трекинг заключается в восстановлении положения одного и того же объекта на последовательности кадров.  
В классическом подходе используются **дискретные визуальные признаки (ключевые точки)**, для которых оценивается смещение между соседними кадрами.

Корректная работа алгоритма основывается на следующих предположениях:

- яркость точек между кадрами меняется незначительно;
- движение объекта между кадрами относительно мало;
- объект содержит достаточное количество текстурных элементов.

---

### Детекция ключевых точек (Shi–Tomasi)

Для выделения ключевых точек используется детектор **Shi–Tomasi**, являющийся развитием детектора Харриса.

Качество точки определяется минимальным собственным значением матрицы градиентов изображения:


Точки с высоким значением данного критерия обладают выраженной локальной структурой и хорошо подходят для отслеживания между кадрами.

---

### Оптический поток (Lucas–Kanade)

Метод **Lucas–Kanade** используется для оценки смещения ключевых точек между соседними кадрами.  
Он основан на предположении постоянства яркости:


Смещение точки оценивается путём решения системы линейных уравнений в локальном окне.  
Для работы с более крупными перемещениями используется пирамидальная версия алгоритма.

---

### Отрисовка положения объекта

В работе реализованы два способа визуализации положения объекта:

- **Bounding Box (BBox)** — прямоугольник, охватывающий текущие позиции отслеживаемых точек;
- **Гомография** — матрица проективного преобразования, связывающая точки первого кадра с текущими позициями.  
  Для устойчивости к выбросам используется метод **RANSAC**.

---

## Описание разработанной системы

### Структура проекта

├── main.py # основной файл программы
├── test_videos/ # тестовые видеоролики
├── result_videos/ # результаты трекинга
└── README.md # описание работы
---

### Алгоритм работы

1. Загрузка видео и чтение первого кадра.
2. Выбор области интереса (ROI) пользователем.
3. Детекция ключевых точек внутри ROI методом Shi–Tomasi.
4. Для каждого последующего кадра:
   - вычисление оптического потока Lucas–Kanade;
   - фильтрация успешно отслеженных точек;
   - обновление положения объекта (BBox или гомография);
   - визуализация результатов.
5. При потере достаточного количества точек выполняется повторная инициализация.

---

## Параметры реализации

- Детектор ключевых точек: **Shi–Tomasi**
- Максимальное число точек: **100**
- Метод оптического потока: **Lucas–Kanade (пирамидальный)**
- Размер окна: **15×15**
- Число уровней пирамиды: **2**
- Критерий остановки: ограничение по итерациям и точности

---

## Экспериментальная часть

### Используемые данные

Алгоритм был протестирован на:

- трёх предоставленных тестовых видеороликах;
- одном видео, записанном самостоятельно, с объектом схожей структуры.

---

### Наблюдения

- алгоритм устойчив при умеренном движении объекта;
- Bounding Box показывает стабильные результаты при размытии;
- гомография обеспечивает более точное позиционирование при хорошем качестве видео;
- потеря трекинга возможна при резких движениях и сильных окклюзиях.

---

## Выводы

В ходе лабораторной работы был реализован прототип системы трекинга объекта на видео на основе ключевых точек и оптического потока.

Разработанный алгоритм:

- корректно отслеживает объекты с выраженной текстурой;
- демонстрирует устойчивость к масштабированию и поворотам;
- позволяет визуально оценивать качество трекинга.

Ограничения метода связаны с качеством входного видео и допущениями, лежащими в основе метода оптического потока.

---

## Используемые библиотеки

- Python
- OpenCV
- NumPy
